import{e as _,t as Z,a as G}from"../../../assets/js/extensionStateStorage.vNeqOHuv.js";import{t as W}from"../../../assets/js/tagActivityStorage.6nHacv1k.js";import{E as x}from"../../../assets/js/EmitLog.VaGcFWYO.js";import{c as H}from"../../../assets/js/_commonjsHelpers.4gQjN7DL.js";import"../../../assets/js/base.zwil0R1V.js";var V={exports:{}};(function(m,t){(function(l,g){g(m)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:H,function(l){var g,h;if(!((h=(g=globalThis.chrome)==null?void 0:g.runtime)!=null&&h.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const v="The message port closed before a response was received.",B=p=>{const S={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(S).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class P extends WeakMap{constructor(r,a=void 0){super(a),this.createItem=r}get(r){return this.has(r)||this.set(r,this.createItem(r)),super.get(r)}}const C=e=>e&&typeof e=="object"&&typeof e.then=="function",k=(e,r)=>(...a)=>{p.runtime.lastError?e.reject(new Error(p.runtime.lastError.message)):r.singleCallbackArg||a.length<=1&&r.singleCallbackArg!==!1?e.resolve(a[0]):e.resolve(a)},b=e=>e==1?"argument":"arguments",u=(e,r)=>function(n,...i){if(i.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${b(r.minArgs)} for ${e}(), got ${i.length}`);if(i.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${b(r.maxArgs)} for ${e}(), got ${i.length}`);return new Promise((A,c)=>{if(r.fallbackToNoCallback)try{n[e](...i,k({resolve:A,reject:c},r))}catch(s){console.warn(`${e} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,s),n[e](...i),r.fallbackToNoCallback=!1,r.noCallback=!0,A()}else r.noCallback?(n[e](...i),A()):n[e](...i,k({resolve:A,reject:c},r))})},T=(e,r,a)=>new Proxy(r,{apply(n,i,A){return a.call(i,e,...A)}});let y=Function.call.bind(Object.prototype.hasOwnProperty);const R=(e,r={},a={})=>{let n=Object.create(null),i={has(c,s){return s in e||s in n},get(c,s,d){if(s in n)return n[s];if(!(s in e))return;let o=e[s];if(typeof o=="function")if(typeof r[s]=="function")o=T(e,e[s],r[s]);else if(y(a,s)){let E=u(s,a[s]);o=T(e,e[s],E)}else o=o.bind(e);else if(typeof o=="object"&&o!==null&&(y(r,s)||y(a,s)))o=R(o,r[s],a[s]);else if(y(a,"*"))o=R(o,r[s],a["*"]);else return Object.defineProperty(n,s,{configurable:!0,enumerable:!0,get(){return e[s]},set(E){e[s]=E}}),o;return n[s]=o,o},set(c,s,d,o){return s in n?n[s]=d:e[s]=d,!0},defineProperty(c,s,d){return Reflect.defineProperty(n,s,d)},deleteProperty(c,s){return Reflect.deleteProperty(n,s)}},A=Object.create(e);return new Proxy(A,i)},q=e=>({addListener(r,a,...n){r.addListener(e.get(a),...n)},hasListener(r,a){return r.hasListener(e.get(a))},removeListener(r,a){r.removeListener(e.get(a))}}),z=new P(e=>typeof e!="function"?e:function(a){const n=R(a,{},{getContent:{minArgs:0,maxArgs:0}});e(n)}),U=new P(e=>typeof e!="function"?e:function(a,n,i){let A=!1,c,s=new Promise(L=>{c=function(f){A=!0,L(f)}}),d;try{d=e(a,n,c)}catch(L){d=Promise.reject(L)}const o=d!==!0&&C(d);if(d!==!0&&!o&&!A)return!1;const E=L=>{L.then(f=>{i(f)},f=>{let j;f&&(f instanceof Error||typeof f.message=="string")?j=f.message:j="An unexpected error occurred",i({__mozWebExtensionPolyfillReject__:!0,message:j})}).catch(f=>{console.error("Failed to send onMessage rejected reply",f)})};return E(o?d:s),!0}),J=({reject:e,resolve:r},a)=>{p.runtime.lastError?p.runtime.lastError.message===v?r():e(new Error(p.runtime.lastError.message)):a&&a.__mozWebExtensionPolyfillReject__?e(new Error(a.message)):r(a)},F=(e,r,a,...n)=>{if(n.length<r.minArgs)throw new Error(`Expected at least ${r.minArgs} ${b(r.minArgs)} for ${e}(), got ${n.length}`);if(n.length>r.maxArgs)throw new Error(`Expected at most ${r.maxArgs} ${b(r.maxArgs)} for ${e}(), got ${n.length}`);return new Promise((i,A)=>{const c=J.bind(null,{resolve:i,reject:A});n.push(c),a.sendMessage(...n)})},K={devtools:{network:{onRequestFinished:q(z)}},runtime:{onMessage:q(U),onMessageExternal:q(U),sendMessage:F.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:F.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},M={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return S.privacy={network:{"*":M},services:{"*":M},websites:{"*":M}},R(p,K,S)};l.exports=B(chrome)}else l.exports=globalThis.browser})})(V);const Q=()=>{_.get().then(m=>{m===!0?(x({name:"background",payload:{msg:"Extension Activated"}}),N(),chrome.tabs.onActivated.addListener(D),chrome.webNavigation.onBeforeNavigate.addListener($),chrome.webRequest.onBeforeRequest.addListener(O,{urls:["*://*.lytics.io/*"]},["requestBody"])):(x({name:"background",payload:{msg:"Extension Deactivated"}}),N(),chrome.tabs.onActivated.removeListener(D),chrome.webNavigation.onBeforeNavigate.removeListener($),chrome.webRequest.onBeforeRequest.removeListener(O))})};_.subscribe(Q);const N=()=>{Z.clear(),G.clear(),W.clear()},D=()=>{N()};chrome.tabs.onActivated.addListener(D);let I;const $=m=>{chrome.tabs.get(m.tabId,t=>{if(chrome.runtime.lastError)return;const l=t.url;if(l){const g=new URL(l).hostname;I!==g&&(N(),I=g,x({name:"background",payload:{msg:`Domain changed to <${g}>`}}))}})};chrome.webNavigation.onBeforeNavigate.addListener($);const w=(m,t,l)=>{const g=new URL(m),h=new URLSearchParams(t),v=g.protocol,B=g.host,p=g.pathname,S=g.search,P=new URLSearchParams(S),C={};P.forEach((T,y)=>{C[y]=T});const k={};h&&h.forEach((T,y)=>{k[y]=decodeURIComponent(T)});let b;C.ts?b=C.ts:k.ts?b=k.ts:b=Date.now().toString();let u;switch(l){case"load-js-tag":u="Loaded the core Lytics JavaScript SDK. Used for collecting data and surfacing the active visitors profile back to the browser.";break;case"load-profile":u="Loaded the active visitors full profile from Lytics.";break;case"collect-data":u="Collected data via jstag.send based on visitor activity.";break;case"load-pathfora-tag":u="Loaded the Pathfora JavaScript SDK for advanced onsite personalization.";break;case"load-pathfora-css":u="Loaded the default Pathfora JavaScript SDK styles to ensure modals and inline widgets are styled correctly.";break;case"load-experience-config":u="Loaded the experience configurations from the Lytics Experience Engine.";break;case"load-campaign-config":u="Loaded the legacy campaign configurations from Lytics. This feature is being deprecated. Reach out to support for additional guidance.";break;default:u=`Communicated with Lytics via a generic or unhandled request (${l}).`}return{protocol:v,host:B,pathname:p,queryParamObj:C,parsedBodyDataObj:k,ts:parseInt(b),type:l,description:u}},O=m=>{var h,v;const t=m.url;let l,g;switch(!0){case t.includes("/api/tag/"):x({name:"background",payload:{msg:"Called Core Tag",url:t}}),g=w(t,{},"load-js-tag");break;case t.includes("/api/personalize/"):x({name:"background",payload:{msg:"Called Entity API",url:t}}),g=w(t,{},"load-profile");break;case t.includes("/c/"):x({name:"background",payload:{msg:"Collection API",url:t}}),m.requestBody&&(l=(v=(h=m==null?void 0:m.requestBody)==null?void 0:h.formData)==null?void 0:v._js[0]),g=w(t,l||{},"collect-data");break;case t.includes("/static/pathfora.min.js"):x({name:"background",payload:{msg:"Called Pathfora Tag",url:t}}),g=w(t,{},"load-pathfora-tag");break;case t.includes("static/pathfora.min.css"):x({name:"background",payload:{msg:"Called Pathfora Styles",url:t}}),g=w(t,{},"load-pathfora-css");break;case t.includes("/experience/candidate"):x({name:"background",payload:{msg:"Called Experience Config API",url:t}}),g=w(t,{},"load-experience-config");break;case t.includes("/api/program/campaign/config"):x({name:"background",payload:{msg:"Called Legacy Campaign Config API",url:t}}),g=w(t,{},"load-campaign-config");break;default:x({name:"background",payload:{msg:"Unhandled API Requset",url:t}})}W.add(JSON.stringify(g))};chrome.webRequest.onBeforeRequest.addListener(O,{urls:["*://*.lytics.io/*"]},["requestBody"]);
