var g=Object.defineProperty;var n=(e,t,i)=>t in e?g(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var s=(e,t,i)=>(n(e,typeof t!="symbol"?t+"":t,i),i);class o{constructor(){s(this,"retryCount",0);this.init()}init(){this.emitLog("tag",{msg:"initialized"}),this.jstagReady(),this.addListeners()}addListeners(){window.addEventListener("message",t=>{if(t.source===window)switch(t.data.action){case"getConfig":this.emitLog("tag","get config"),this.getConfig();break;case"getEntity":this.emitLog("tag","get entity"),this.getEntity();break;case"getUID":this.emitLog("tag","get UID");break;case"getExperiences":this.emitLog("tag","get experiences");break;default:this.emitLog("tag",`invalid action: ${t.data.action}`);break}})}emitLog(t,i){console.log(`lyticsdev ::: ${t} ::`,i)}jstagReady(){this.emitLog("tag","checking jstag"),this.retryCount++,typeof window.jstag<"u"?(this.emitLog("tag","found jstag"),setTimeout(()=>{this.getConfig()},2e3),this.getEntity()):(this.emitLog("tag",{msg:"jstag not found trying again in 2 seconds",retryCount:this.retryCount}),setTimeout(()=>this.jstagReady(),2e3))}getConfig(){window.jstag.call("entityReady",()=>{this.dispatchEvent("config",window.jstag.config)})}getEntity(){window.jstag.call("entityReady",t=>{window.jstag.getid(i=>{t.data._uid=i,this.dispatchEvent("entity",t)})})}dispatchEvent(t,i){const a=new CustomEvent(t,{detail:{data:JSON.stringify(i)}});document.dispatchEvent(a)}}new o;
